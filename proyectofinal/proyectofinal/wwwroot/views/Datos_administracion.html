<!DOCTYPE html>
<html lang="es">
<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title>Formulario Secretaría</title>
 <style>
 * { box-sizing:border-box; margin:0; padding:0; font-family:'Poppins',sans-serif; }
 body { background:#fff; display:flex; justify-content:center; align-items:center; min-height:100vh; }
 .container { display:flex; align-items:center; justify-content:space-between; max-width:950px; width:100%; background:#f9f9f9; border-radius:12px; box-shadow:04px10px rgba(0,0,0,.1); padding:40px; gap:40px; }
 .formulario { flex:1; display:flex; flex-direction:column; gap:10px; }
 .formulario h2 { margin-bottom:15px; color:#333; }
 label { font-weight:600; color:#444; }
 input { padding:8px10px; border:1px solid #ccc; border-radius:6px; outline:none; transition:.3s; }
 input:focus { border-color:#5a49e3; }
 button { margin-top:20px; background:#5a49e3; color:#fff; border:none; border-radius:6px; padding:10px20px; font-weight:bold; cursor:pointer; transition:.3s; }
 button:hover { background:#4637b8; }
 .imagen img { width:350px; max-width:100%; }
 .nota { font-size:12px; color:gray; }
 .err { color:#b30000; font-size:13px; }
 .ok { color:#0a7a00; font-size:13px; }
 @media (max-width:768px){ .container{ flex-direction:column; text-align:center; gap:20px; } .imagen img{ width:220px; } }
 </style>
</head>
<body>
 <div class="container">
 <form class="formulario" id="formDatos">
 <h2>Datos Secretaría</h2>

 <label for="nombre">Nombre:</label>
 <input type="text" id="nombre" required>

 <label for="apellido">Apellido:</label>
 <input type="text" id="apellido" required>

 <label for="dui">DUI:</label>
 <input type="text" id="dui" required>

 <label for="especialidad">Especialidad:</label>
 <input type="text" id="especialidad" required>

 <label for="telefono">Teléfono:</label>
 <input type="tel" id="telefono" required>

 <label for="fecha">Fecha:</label>
 <input type="date" id="fecha" required>

 <label for="correo">Correo:</label>
 <input type="email" id="correo" required>

 <label for="direccion">Dirección:</label>
 <input type="text" id="direccion" required>

 <label for="foto">Foto (opcional):</label>
 <input type="file" id="foto" accept="image/*">

 <button type="submit">Guardar y continuar</button>
 <span id="estado" class="nota"></span>
 <p class="nota">Completa y guarda para continuar</p>
 </form>

 <div class="imagen">
 <img src="/img/registrate.jpg" alt="Imagen">
 </div>
 </div>

 <script>
 const idSecretaria = parseInt(localStorage.getItem('idSecretaria')||'0',10);
 if(!idSecretaria){ window.location.href='cuenta_Secretaria.html'; }
 const form = document.getElementById('formDatos');
 const estado = document.getElementById('estado');

 form.addEventListener('submit', async (e)=>{
 e.preventDefault();
 estado.textContent=''; estado.className='nota';
 const nombre = document.getElementById('nombre').value.trim();
 const apellido = document.getElementById('apellido').value.trim();
 const dui = document.getElementById('dui').value.trim();
 const especialidad = document.getElementById('especialidad').value.trim();
 const telefono = document.getElementById('telefono').value.trim();
 const fecha = document.getElementById('fecha').value; // yyyy-MM-dd
 const correo = document.getElementById('correo').value.trim();
 const direccion = document.getElementById('direccion').value.trim();
 const fotoInput = document.getElementById('foto');

 if(!nombre||!apellido||!dui||!especialidad||!telefono||!fecha||!correo||!direccion){
 estado.className='err'; estado.textContent='Completa todos los campos.'; return;
 }

 const fd = new FormData();
 fd.append('idSecretaria', idSecretaria);
 fd.append('nombre', nombre);
 fd.append('apellido', apellido);
 fd.append('dui', dui);
 fd.append('especialidad', especialidad);
 fd.append('telefono', telefono);
 fd.append('fecha', fecha);
 fd.append('correo', correo);
 fd.append('direccion', direccion);
 if(fotoInput.files && fotoInput.files.length>0){ fd.append('foto', fotoInput.files[0]); }

 try{
 const res = await fetch('/api/UsuarioSecretaria/guardarDatosConFoto', { method:'POST', body: fd });
 if(res.status===409){ const d=await res.json(); estado.className='err'; estado.textContent=d.mensaje||'Ya existen datos.'; window.location.href='inicio_Secretaria.html'; return; }
 if(!res.ok){ const d=await res.json().catch(()=>({})); estado.className='err'; estado.textContent=d.detalle||d.mensaje||'Error al guardar.'; return; }
 window.location.href='inicio_Secretaria.html';
 }catch(err){ estado.className='err'; estado.textContent='Error de red.'; }
 });
 </script>
</body>
</html>